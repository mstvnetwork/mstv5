<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MSTV NETWORK</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: Arial, sans-serif; background: #111; color: white; margin: 0; padding: 0; }
  header { text-align: center; padding: 10px; font-size: 24px; font-weight: bold; background: #222; }
  .poster-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 5px; padding: 10px; }
  .poster-grid img { width: 100%; border-radius: 5px; }
  .channel-select { text-align: center; padding: 10px; }
  select { padding: 5px; font-size: 16px; }
  .player-container { position: relative; width: 100%; max-width: 800px; margin: 0 auto; background: black; }
  iframe, video { width: 100%; height: 450px; }
  .mute-toggle { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.6); border-radius: 50%; padding: 5px; cursor: pointer; font-size: 20px; }
  .facebook-link { text-align: center; padding: 10px; }
  .facebook-link a { color: #3b5998; font-size: 18px; text-decoration: none; }
  footer { background: #222; text-align: center; padding: 15px; font-size: 14px; margin-top: 20px; }
  .banner { background: #0055ff; padding: 5px; white-space: nowrap; overflow: hidden; }
  .banner span { display: inline-block; padding-left: 100%; animation: scroll 15s linear infinite; }
  @keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
</style>
</head>
<body>

<header>MSTV NETWORK</header>

<div class="poster-grid">
  <img src="https://via.placeholder.com/150x80?text=Poster1">
  <img src="https://via.placeholder.com/150x80?text=Poster2">
  <img src="https://via.placeholder.com/150x80?text=Poster3">
  <img src="https://via.placeholder.com/150x80?text=Poster4">
</div>

<div class="channel-select">
  <label for="channelSelector">Select Channel:</label>
  <select id="channelSelector"></select>
</div>

<div class="player-container">
  <div class="mute-toggle" id="muteToggle">ðŸ”Š</div>
  <div id="player"></div>
  <div class="banner"><span id="scrollingBanner"></span></div>
</div>

<div class="facebook-link">
  <a href="https://facebook.com" target="_blank">ðŸ“˜ Click here to follow</a>
</div>

<footer>
  <p>About Us: MSTV Network brings you globally synced live-style programming 24/7.</p>
  <p>&copy; 2025 MSTV Network. All Rights Reserved.</p>
</footer>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
const channels = [
  {
    name: "MSTV Channel 1",
    json_url: "https://raw.githubusercontent.com/mstvnetwork/mstv1/main/sync-ch1.json"
  },
  {
    name: "MSTV Channel 2",
    json_url: "https://raw.githubusercontent.com/mstvnetwork/mstv1/main/sync-ch2.json"
  }
];

let player;
let videoList = [];
let startTimeUTC = 0;
let isMuted = localStorage.getItem("muted") === "true";

// Populate dropdown
const channelSelector = document.getElementById("channelSelector");
channels.forEach((ch) => {
  const option = document.createElement("option");
  option.value = ch.json_url;
  option.textContent = ch.name;
  channelSelector.appendChild(option);
});

// Load channel JSON and start playback
async function loadChannel(jsonUrl) {
  try {
    const response = await fetch(jsonUrl);
    const data = await response.json();
    videoList = data.video_list;
    startTimeUTC = new Date(data.start_time_utc).getTime() / 1000;
    startGlobalSync();
  } catch (error) {
    console.error("Error loading channel:", error);
  }
}

// Global sync logic
function startGlobalSync() {
  const now = Math.floor(Date.now() / 1000);
  let elapsed = (now - startTimeUTC) % videoList.reduce((a, b) => a + b.duration_seconds, 0);

  let index = 0;
  while (elapsed >= videoList[index].duration_seconds) {
    elapsed -= videoList[index].duration_seconds;
    index = (index + 1) % videoList.length;
  }

  const videoId = videoList[index].id;
  const seekTo = elapsed;
  document.getElementById("scrollingBanner").textContent = videoList[index].title;

  if (player && typeof player.loadVideoById === "function") {
    player.loadVideoById({ videoId: videoId, startSeconds: seekTo });
    if (isMuted) player.mute(); else player.unMute();
  } else {
    player = new YT.Player("player", {
      videoId: videoId,
      playerVars: { autoplay: 1, controls: 0, start: seekTo },
      events: {
        onReady: (event) => {
          if (isMuted) event.target.mute(); else event.target.unMute();
        },
        onStateChange: (event) => {
          if (event.data === YT.PlayerState.ENDED) startGlobalSync();
        }
      }
    });
  }
}

// Channel change event
channelSelector.addEventListener("change", () => {
  loadChannel(channelSelector.value);
});

// Auto-load first channel
window.addEventListener("DOMContentLoaded", () => {
  channelSelector.selectedIndex = 0;
  loadChannel(channels[0].json_url);
});

// Mute toggle
document.getElementById("muteToggle").addEventListener("click", () => {
  isMuted = !isMuted;
  localStorage.setItem("muted", isMuted);
  if (player) {
    if (isMuted) player.mute(); else player.unMute();
  }
  document.getElementById("muteToggle").textContent = isMuted ? "ðŸ”‡" : "ðŸ”Š";
});
</script>

</body>
</html>
